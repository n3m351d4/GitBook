---
description: Статья от нашей команды, автор анонимен Inside, 2023
---

# Безопасность iCloud Keychain

Однажды меня спросили:

1\. Насколько безопасно использовать связку ключей в MacOS для сохранения конфиденциальных данных?

2\. Насколько безопасно хранить пароли в iCloud?

&#x20;До этого мне не приходилось основательно изучать данные вопросы, но у меня были некоторые мысли и заметки. В этой статья я поделюсь своими находками и выводами с вами. Хочу сразу отметить, что мы не будем рассматривать схемы шифрования, их преимущества и недостатки. Не прибегая к сложным техническим методам, мы взглянем на указанные выше вопросы глазами заинтересованного обывателя, умеющего читать между строк.

## Введение. <a href="#_u6lcojxvq3bg" id="_u6lcojxvq3bg"></a>

В своей статье про [безопасность iCloud](https://support.apple.com/en-us/HT202303) Apple рассказывает о том, что использует самые удобные и самые безопасные функции. Давайте проанализируем статью и посмотрим на реальное положение дел.

&#x20;В iCloud Apple разделяет информацию на две категории и шифрует их по-разному:

\-       для части данных используется end-to-end (E2E) шифрование между устройствами;

\-       другую часть данных Apple шифрует своими ключами и хранит у себя на серверах.

&#x20;Дополнительно, стоит отметить, что в статье говорилось о том, что в 2023 году Apple внедрит схему Advanced Encryption, которая будет использовать E2E-шифрование для большей части данных. На текущий момент активация этой схемы шифрования данных доступна для пользователей из некоторых стран.

&#x20;Скрытый смысл данной статьи — **продать вам iCloud.**

E2E терминология используется здесь как маркетинговый ход, так как ее реализация не вызывает доверия:

_"при добавлении нового устройства, пользователь получает шестизначный код на trusted device (доверенное устройство) и этим кодом авторизует новое устройство, на которое iCloud Keychain загружает свои данные из облака."_

Apple говорит о том, что именно так оно защищает E2E данные и делает возможными их репликацию.

Стоит заметить, что схема с “доверенными” устройствами работает исключительно при наличии второго фактора. Чем же защищены “простые” аккаунты - неизвестно.

## А что же с Keychain? <a href="#_30nu3gvu3vo9" id="_30nu3gvu3vo9"></a>

Keychain является контейнером E2E-шифрованных данных, ключ от которых хранится на “trusted devices” (доверенном устройстве).

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

Схема рассмотренная выше идеальна - за исключением одного: запрос на авторизацию нового устройства проходит через сервера Apple.

&#x20;Если рассмотреть процесс внимательно, то можно представить себе достаточно экзотический сценарий получения доступа к iCloud без участия владельца аккаунта – перехват авторизационного запроса непосредственно на серверах компании Apple. Из этого можно сделать следующий вывод - если в вашей модели угроз не существует “угрозы, способной получить доступ к целевым серверами либо влиять на компанию Apple”, то вы находитесь в относительной безопасности. Если же для вас подобная угроза существует - считайте, что сотрудник Apple живет в вашем устройстве.

В противовес можно рассмотреть настоящую схему E2E, как, например, у секретных чатов в Telegram - которые не синхронизируются, не восстанавливаются и имеют публичные алгоритмы и клиенты.

Apple старается найти баланс между защитой и удобством пользователя, получается неплохо, но стоит вывести данный механизм из “серой зоны” в публичную.

Казалось бы, E2E, шифропанки, все дела.

#### Что дальше? <a href="#_nw7x4o1zitb7" id="_nw7x4o1zitb7"></a>

Стоит отметить, что есть некоторые категории данных (например, сгенерированные приватные ключи) которые являются не экспортируемыми, потому что хранятся в TPM устройства (Secure Enclave) и в другом месте хранить их физически невозможно. Они не синхронизируются в Keychain. Зато парольные фразы (passphrases) от них - синхронизируются.

Недавно в интернете обсуждалось использование программы ssh-add в MacOS. Действительно, в ней есть ключ (--apple-use-keychain) позволяющий положить passphrase (от сгенерированного вами приватного ключа) в Keychain.

Несмотря на то, что существует возможность локального хранения passphrase в Keychain на устройстве с помощью указания атрибута ["this device only"](https://developer.apple.com/documentation/security/ksecattraccessiblealwaysthisdeviceonly), разработчики ssh-add проигнорировали данную возможность и не указали его, не давая тем самым пользователю выбрать место хранения passphrase. Соответственно, в программе ssh-add при использовании Keychain, passphrase будет синхронизирована в iCloud.

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

При добавлении passphrase в Keychain происходит:

<figure><img src="../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

### Вывод

В качестве парольного менеджера использовать iCloud Keychain можно. При условии, что вы не потеряете доступ к своему аккаунту, не входите в чужие iCloud по просьбе из интернета и у вас нет больше никаких других устройств вне экосистемы Apple. В противном случае про синхронизацию веб логинов и паролей можно забыть.

Есть и другие коммерческие менеджеры паролей, но иногда их ломают:

\-       LastPass – неизвестно, что у них утекло (возможно, процедуры восстановления мастер ключей);

\-       Bitwarden – использует сомнительную схему - ты должен доверять JS'у который тебе присылает сервер.

В конечном итоге, у каждого парольного менеджера найдутся свои недостатки.

__
