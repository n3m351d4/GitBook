---
description: 02 08 2020
---

# IMPORTOZAMESHENIE: как устройство училось говорить по-русски

## **Введение**

Многие поймут меня, если я скажу, что большинство оплачиваемых проектов начинается с вопроса “Сколько будет стоить %очень\_широкое\_определение%?”. Я постараюсь описать процесс таким образом, чтобы вы могли почувствовать, сколько неопределенностей встречается при решении подобных задач. Итак,  %очень\_широкое\_определение% - оказалось переводом на русский язык устройства. Если говорить грамотно - русификацией. 

## **Неизвестный науке зверь** 

Итак, какой же девайс мы будем рассматривать? На входе было известно, что это устройство принадлежит к группе устройств, предназначенных для проведения конференций. Из подобных устройств мне было на тот момент уже известно два вида - микрофон с “мозгами” в виде коробки и сенсорной панели и какое - то серверное оборудование. На этом моменте становится вполне очевидным то, что мне может попасть в руки два типа устройств - какое-то на линуксе \(к которому возможно получить доступ по сети\) либо из которого придется читать прошивку. Исчерпывающая информация, не правда ли?

Далее я получаю фотографию модульного устройства с вопросом: “Какую плату надо тебе прислать, для того, чтобы провести русификацию”?

Внимательно смотрим на изображение и пытаемся ответить на вопрос.

![](https://lh4.googleusercontent.com/JsUuFXTakjyRDBPzf3GWaJLt_7AHQWX8tm_TJ0hInlwJ36FZja23W6B2yu6HXYz7hfGRh5TOQSLbkxseYIJ4_mccCWloWacAMIbFzuz6YEgHidOZJnwirvWJFuYf9nFlO8EDszY)

Если вам удалось выбрать требуемую плату, то выйдите вон, потому что ответ на данный вопрос может быть только один - “Вы шо, упали?”. Действительно, слева внизу мы можем наблюдать трансформатор, справа вверху тоже какая-то силовая часть, справа внизу - какой-то интерфейс, в центре под модулем видим uart \(делаем земной поклон, крестимся - слава богу!\) и на модуле фиксируем взглядом длинные микрухи \(пахнет памятью\) - скорее всего - рядом МОСК устройства. Исходя из этого формируем ответ - девайс нужен целиком, ибо мы будем пытаться ковырять его через UART, соответственно при загрузке он будет проверять все ли к нему подключено и требовать везде определенные уровни напряжения, которые обеспечивает силовая часть \(потому что подавать ему напругу и эмулировать интерфейсы - нам нечем, да и займет это в триста раз больше времени :D\).

Итак, к нам в гости приезжает сей крокодил.

![](https://lh4.googleusercontent.com/dksQYw3R-ostEwBQn60owr0jar3LMBCXfbCOtevKPSsOlMJULkvvIBs_l7p1vRQEs2veCCyNGf6QgQW8tWHi2G-7xKHkvZJYjnLsiRdt9wLM_A95Mck7tDG3ySdDamr6mf2EnDY)

## **Доступ**

Прежде чем начать тыкать в беднягу уартом, надо было забутить его и посмотреть, что он вообще умеет и что из себя представляет \(производитель склонировал его у другого производителя и из информации о данном устройстве - есть крайне скудная страничка в интернет-магазине и один обзор на ютубе на китайском\). Вся прочая информация, видимо, добывается при помощи переписки с поставщиком.

У устройства был сенсорный \(резистивный, тьфу!\) дисплей, необходимо взглянуть ему в лицо! \(Фото немного опережает события\). Здесь мы видим окно настроек.

![](https://lh4.googleusercontent.com/iUlhhRZ4n5eOp939gCU5v6zy7wrnFcucXlC3GBEL7ictAFzQ0vZXaUwU9bJkQzB9FEFT6SGB_KQFfpaJ3CcBG9QydTp78DPs8dqUmlptn49SZHp-6Q1D2ng2hIF0dtqu1A963X0)

Также были обнаружены функции назначения переводчика, всякие настройки, изменение названий камер и их позиции, аудиоплеер и прочая хрень. Хочу обратить внимание, что для доступа к настройкам было необходимо ввести пароль. Пароль был угадан - 123456. Устройство предложило вставить флешку и скопировать свой конфиг на нее \(да, оно поддерживает монтирование флешки для записи звука и/или проигрывания треков\). В конфиге был пароль производителя \(мы так и не поняли, куда его надо вводить, но он отличался от 123456\).

![](https://lh3.googleusercontent.com/nTXyrAXZOr5d_5g0IUkYlizag8TsXTvLOUjE7ML-HfZfwYQowQs6AXNRZdcqjBIC76FD7oG2FEoqUnuzxQ-pwtwIFBFF_-7Ivdaz8cMmO4NRt2tHUdPjfepbhPOw-ifMwC63v4E)

После осмотра морды лица данного товарища, был осуществлен ребут и подключение через уарт \(tx, rx, gnd - в таком случае питание не подключается, так как устройство запитано\). Во время бута, судя по логам, он поднял какие-то сервисы и веб. В результате загрузки система представилась - Friendly ARM и дала права пользователя root. В принципе, на этом моменте, я закатилась от смеха под кровать. 

![](https://lh3.googleusercontent.com/V5nt4aNSTQ2L4u3VC7vqsSeO0i9E3gyA2e0VzsZ_WEUmJD5loOS0S2om77DL2qh2gmPtzKEOszBE1MEA-sZP4vFi0rUx9zoWUMF_nDVW3kzRgxZnDGLZbS8M6PWWQBgZ-E5u27E)

Выкатившись, в файловой системе мы обнаружили папочку с названием, похожим на на название нашего девайса, но отличающимся некоторыми цифрами \(они заливают во все модели одну и ту же прошивку!?\). В папочке лежал конфиг, который нам предложили скопировать на флешку, картиночки и бинарь. Вся папочка была успешно скопирована на флеш и изучена.

По дефолту устройство поддерживало китайский и английский языки, соответственно, желательно было заменять китайский на русский.

## **Гуй** 

Итак, часть гуя сие чудо хранило в виде PNG - файлов, из-за чего, мне пришлось просидеть несколько дней в paint net. Всего в папке с бинарем было 253 графических файла.

Подводные:

На китайском динамические элементы расположены по горизонтали, на английском - по вертикали.

![](https://lh3.googleusercontent.com/kTBkAYyPJl-uHCbmuE06ppkEzjrCtgvpbeqUvv1DgHmfWzPpIG51WZktZJU35a8AnUj5qYoAOOCfMMW-VvctEO9baQyC-KxBlBDRYCwspotf_-EKhmkPcNNbauA1HITRntKCYJw)

Градиенты на кнопках - пришлось аккуратно копировать вертикальные участки и растягивать их, замазывая текст, ориентируясь по пикселям.

![](https://lh3.googleusercontent.com/tAtwmITppfC3qyJN185sj-dAj3zJmvepRf0XKTxVTP_RGXxpwdFN-9Ttt81M5IfNdg8ORkgC_hKfyyx58_AWKC-uVgzWchkA58DkrNOxhysP8-GpKa-fO4ARpqXAHXW2J9NFFL0)

![](https://lh4.googleusercontent.com/D_qSpyMddj7PBmSXcVYcCJEUBMTwxyCiP5QNYYe2_9UQelAoxbaTrjD3-iH5z1wkQW2MPK24eZtOeHt4wFhL_w3LzVFalslsXg5bE5j5ghRKkoc7t4DBB0XblDOQlEgwd84daM4)

В общем и целом - заседания в пенте.

![](https://lh4.googleusercontent.com/XcsF0tTDpgiLtHIXL61w3V06gmtdHbrpTCHOFB7qOXCeM6mQUd2KhrrLvSQRhDcO7jFjbINe_DtP7NZQ_5_jkB-oFfuaCwRhiww9iY3fBi5fjSP2llySPH6tEeOFsOjAG5UOxzk)

Далее гуи лечились подменой в папке на сделанные мной, с соответствующими именами через уарт.

## **Бинарь**

Бинарь бодро распаковался, как бы приглашая сделать аппаратные закладки :D Хотя, зачем, если там был целый рут, который давал возможность свое ПО накатить \(делать это мы, конечно не стали, так как мы люди порядочные :\)\).

С учетом того, что прошивка была скопирована китайцами, допилена под китайский язык, и, вероятно, побывала в руках десятков людей в ней были следующие страшные вещи:

1. Часть гуя отрисовывалась через бинарь - даты, ошибки, некоторые динамические элементы.

![](https://lh6.googleusercontent.com/HFiEqj2OBi810LmZhTAQwEEExmOeq4zmPad_jiAjwShRJgwRkAQK-r_PH2BzdH4mn79pE1k4J5sBO4CNFD3B15NiqC4jCwf15MkXoNWEs16F0TnO3fNc4uWrq0-Gb8XDrlATv5A)

Патчилось это путем вычисления эквивалентного китайской фразе количества бит и последующим вставлением эквивалентного количества бит кириллицы :D Всего было накатано 2000 патчей.

![](https://lh6.googleusercontent.com/cLFBvyoCH5IeC0mQcvx5N1eelKgZ9N1h5Dp34EFkMqC1FBqbUb8Vk6FfJLqq236lDblJ-h8WrwLqHDGEcIrIAWF1NCij-wmt9YW_tqyMrNmuiqzJXaOiomy-NXg5IQaY1S8Tscg)

Особый гемморой представляла собой клавиатура, которая была приделана китайцами отдельным модулем и являлась подобием T9 \(слова вводятся на латыне, а в окне предлагаются подходящие иероглифы\).

![](https://lh4.googleusercontent.com/PX_BXxGFZpz7TK3nG3NfvI2Ro0uMpDdocuFRSF0Y3xrJOOcqRbSZSLEiJ0DAeO-9piAf1uzwMgSwpi0a_UVIWBtBoydpxTdkd8GezJ1LKoJsCg7hJAzWNMb9uq-H6s7wcbA5w_k)

При отрубании клавиатуры через бинарь, устройство хронически уходило в ребут. Поэтому, китайская клавиатура осталась на месте, просто по дефолту всегда запускается английская версия. \(Иероглифы из имени камер были убраны\).

А здесь переполнилось и в соседнюю локаль вылезла буква:

![](https://lh5.googleusercontent.com/rmPvr9-2xnPA9bcnCFGsqjK9rYHN1nA6grZF_evL_H7CG_RkpYxvDbnlWkS3L6On6H9tknTm1Pl6qostOZwtDnxzefWEWUfrFNiyqTWxmYrchHJh38pgqUFrsZMuRD1WFYqiWtY)

## **Заключение**

Проект оказался крайне милым, сбалансированным по сложности/скучности. Но эта железка - просто писец, все крутится от рута, все сервисы от рута, все дампится… ААА....

Поэтому, просто полюбуемся его фотками из рабочего процесса:

![](https://lh6.googleusercontent.com/XICq9wZ2W7hUHM0vCAjhPmclmM_UMe1FWcRrJWVOMMYxh7G_GyIeSFbdI-XzFcoqD3W1EsNCpyo9KmtjhkjcNp9zlY-byIka_WBLewUQbo6FrQE_GN_0KnOBBiVXD_rlf3_6U7U)

![](https://lh3.googleusercontent.com/PieBPj9B7MYoSyyiUkJlbF0INTpkDuwV1BcT9GR5vqEE-BvED_b4EzPCbVPO6TEYZ2dSNfmn03jwyn2sT_TLMBmPPFrop0EkOZ0ycX9RIDUffGEHwHqizIRwlTAGtqtoUqEZ3K0)

