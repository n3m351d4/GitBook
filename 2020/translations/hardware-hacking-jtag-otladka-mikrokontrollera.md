# Hardware Hacking: JTAG – отладка микроконтроллера

_Перевела @ZzzNein \(безграничную благодарность можно выразить здесь - \), проверила @N3M351DA._ [_Оригинальный текст_](https://www.blackhillsinfosec.com/jtag-micro-controller-debugging/) _- Реймонд Фелч, 23 августа 2019 г._

## Введение

Почти всю жизнь проработав инженером-разработчиком прошивок встраиваемых систем, я довольно быстро заинтересовался реверс-инжинирингом с помощью JTAG. Данный текст поможет больше узнать об этом абстрактном и поэтому зачастую игнорируемом векторе атаки.

_Информация из https://ru.wikipedia.org/wiki/JTAG_

**JTAG** \(сокращение от англ. Joint Test Action Group; произносится «джей-тáг»\) — название рабочей группы по разработке стандарта IEEE 1149. Позднее это сокращение стало прочно ассоциироваться с разработанным этой группой специализированным аппаратным интерфейсом на базе стандарта IEEE 1149.1. Официальное название стандарта **Standard Test Access Port and Boundary-Scan Architecture**. Интерфейс предназначен для подключения сложных цифровых микросхем или устройств уровня печатной платы к стандартной аппаратуре тестирования и отладки.

На текущий момент интерфейс стал промышленным стандартом. Практически все сколько-нибудь сложные цифровые микросхемы оснащаются этим интерфейсом для:

·  выходного контроля микросхем при производстве

·  тестирования собранных печатных плат

·  прошивки микросхем с памятью

·  отладочных работ при проектировании аппаратуры и программного обеспечения

Метод тестирования, реализованный в стандарте, получил название Boundary Scan \(граничное сканирование\). Название отражает первоначальную идею процесса: в микросхеме выделяются функциональные блоки, входы которых можно отсоединить от остальной схемы, подать заданные комбинации сигналов и оценить состояние выходов каждого блока. Весь процесс производится специальными командами по интерфейсу JTAG, при этом никакого физического вмешательства не требуется. Разработан стандартный язык управления данным процессом — Boundary Scan Description Language \(BSDL\).

Стандарт предусматривает возможность подключения большого количества устройств \(микросхем\) через один физический порт \(разъем\).

Порт тестирования \(TAP — Test Access Port\) представляет собой четыре или пять выделенных выводов микросхемы: ТСК, TMS, TDI, TDO и \(опционально\) TRST.  
  
__**JTAG** – отладочный интерфейс, который стал промышленным стандартом для отладки и непрерывной диагностики интегральных схем после сборки печатной платы. Первоначально стандарт предлагал производителям упрощенный способ тестирования конструкции печатной платы. Сейчас он стал еще более актуален ввиду снабжения многих устройств технологией шариковых выводов \(BGA\), что затрудняет тестирование ввиду малых размеров. Кроме того, открытый интерфейс дает инженерам инструмент анализа сигналов без прямого взаимодействия с использованием физического подключения к схеме.

После просмотра множества видео о JTAG я обнаружил ряд положительных преимуществ при получении доступа целевому устройству, в особенности – возможность чтения и записи на эти устройства. Возможности казались безграничными. 

Чтобы начать работу, на местной распродаже я нашел маршрутизатор Linksys BEFSR41 версии 2. Именно его мне не хватало, чтобы начать экспериментировать с некоторыми из огромного количества аппаратных и программных инструментов JTAG. Я решил повторить достижения некоторых авторов тех видео, что просмотрел ранее.

Проведя более глубокие исследования, я решил приобрести плату JTAGulator фирмы Parallax и пару популярных плат с последовательным интерфейсом: DangerousPrototypes Bus Pirate, Bus Blaster и Attify Badge.

Сначала я работал с JTAGulator, аппаратным инструментом с открытым исходным кодом, разработанным Джо Грандом. Он может не только обнаруживать, но и идентифицировать контакты JTAG на целевой плате, что, в свою очередь, дает возможность находить интерфейсы отладки на кристалле \(OCD\). В этом инструменте также заложена возможность находить и идентифицировать контакты UART.

**Характеристики**

· 24 канала I/O с защитой на входе

· регулируемое целевое напряжение для преобразования уровня: 1.2В в 3.3В

· поддерживаемые интерфейсы \(начиная с версии прошивки 1.1.1.\): JTAG/IEEE, UART/асинхронный последовательный порт

· USB-интерфейс \(FTDI FT32\) для прямого соединения с хост-машиной \(ПК, Mac или \*nix\)



