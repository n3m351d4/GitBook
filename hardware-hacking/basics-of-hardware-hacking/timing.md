---
description: 'Перевод: @beh1ndy0urback 07/2021'
---

# Тайминги

[**Источник**](https://maldroid.github.io/hardware-hacking/)

Использование метода `checkPass` займет больше времени для проверки, если некоторые символы будут введены корректно и совпадут с легитимным паролем.

Взгляните на пошаговую проверку двух паролей: в одном все символы неверны, а во втором - один правильный:

| `xxxxx` | `pxxxx` |
| :--- | :--- |
| `i = 0` | `i = 0` |
| `i < 5` | `i < 5` |
| `read PASSWORD[0]` | `read PASSWORD[0]` |
| `read buffer[0]` | `read buffer[0]` |
| `compare two values` | `compare two values` |
| `return false` | `i = 1` |
| - | `i < 5` |
| - | `read PASSWORD[1]` |
| - | `read buffer[1]` |
| - | `compare two values` |
| - | `return false` |

Как вы можете видеть, в первом случае цикл `for` выполняет только одну итерацию \(поскольку первый символ неверен\), а во втором случае - две \(поскольку первый символ правильный, а второй неверный\). В этом весь смысл более быстрого возврата из метода - чтобы он работал быстрее и потреблял меньше ресурсов.

А можем ли мы обнаружить эту разницу во времени выполнения, если у нас есть доступ к оборудованию? Давайте сначала настроим тестовую среду.  
  
Мы будем использовать плату Arduino Uno, в которой используется процессор ATMega328, как на изображении ниже:

![ATMega328 CPU](https://maldroid.github.io/hardware-hacking/assets/atmega328p-pu.jpg)

На плате также есть элементы, отвечающие за обеспечение стабильности питания \(конденсаторы\), за соединение с компьютером \(разъем USB\) и за возможность подачи питания от внешнего источника. На рисунке ниже показаны основные компоненты платы:

![Annotated Arduino Uno board](https://maldroid.github.io/hardware-hacking/assets/arduino_uno_annotated.jpg)

МК можно запрограммировать на проверку пароля с помощью Arduino IDE. После вставки кода мы можем скомпилировать его и загрузить на плату. Затем мы просто подключаемся к плате с помощью консоли и видим запрос пароля, как показано ниже:

```text
$ picocom /dev/ttyACM0 -b 115200
picocom v3.1

port is        : /dev/ttyACM0
flowcontrol    : none
baudrate is    : 115200
parity is      : none
databits are   : 8
stopbits are   : 1
...

Type [C-a] [C-h] to see available commands
Terminal ready
Password:
```

Теперь у нас есть доступ к плате, на которой работает наш код. Как мы будем измерять время, необходимое для проверки пароля? Мы можем создать скрипт, который измеряет время, когда пароль был отправлен и когда получен результат проверки, но между временем фактического получения результата и временем получения сообщения есть разница, которая влияет на точность такого измерения. 

Вместо этого мы можем использовать логический анализатор от [Saleae](https://www.saleae.com/). Логический анализатор - это аппаратное обеспечение, которое может перехватывать и записывать цифровые данные с платы. ЦП ATMega328 использует последовательную связь, как и USB \(«S» означает «последовательный»\). Это означает, что есть два контакта - один для отправки данных \(TX\) и один для приема данных \(RX\). Они доступны через два пина ATMega328:

![Annotated ATMega CPU](https://maldroid.github.io/hardware-hacking/assets/atmega_annotated.jpg)

Эти контакты видны на плате в правом верхнем углу \(см. изображение платы выше\). Они даже имеют удобную маркировку «RX» и «TX». Это те же данные, которые отправляются через USB на последовательный терминал, работающий на компьютере. Подключим к этим двум выводам логический анализатор и запишем весь процесс коммуникации.

