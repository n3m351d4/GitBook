---
description: Перевод @n3m351da @in51d3 2020
---

# Hardware Hacking: GSM и шифрование: поточный шифр A5/1

[Оригинальный текст](https://www.blackhillsinfosec.com/gsm-traffic-and-encryption-a5-1-stream-cipher/)

**Внимание!** При передаче любых данных обязательно используйте клетку Фарадея или экранированную сумку, чтобы случайно не нарушить каких-либо законов несанкционированным вмешательством в эфир на определенных частотах. Кроме того, помните, что перехват и дешифрование/декодирование чужих данных является незаконным, поэтому будьте осторожны при исследовании вашего трафика.

## **Немного терминологии**

_Термины, связанные с мобильным телефоном: _

* Мобильная станция **МС **(телефон)&#x20;
* Модуль идентификации абонента **SIM **(sim-карта)
* **IMSI **международный идентификатор мобильного абонента&#x20;
* **TMSI **временный IMSI (помогает с конфиденциальностью, обфусцируя IMSI)&#x20;
* **Ki **128-битный уникальный ключ абонента (в паре с IMSI)

_Термины, связанные с базовой станцией:_

* Базовая приемопередающая станция **BTS **(содержит оборудование для передачи и приема радиосигналов, антенны и оборудование для шифрования и дешифрования связи с контроллером базовой станции (BSC))&#x20;
* Контроллер базовой станции **BSC **(распределяет радиоканалы, принимает измерения с мобильных телефонов и управляет передачей обслуживания от BTS к BTS)

_Термины, связанные с базовой сетью: _

* Подсистема сети **NSS**, отвечающая за маршрутизацию вызовов через BSC и BTC
* Центр коммутации мобильной связи **MSC **(коммутация сети)&#x20;
* Регистр местоположения абонентов **VLR **(база данных мобильных станций, относительно их местоположения)&#x20;
* Реестр домашнего местоположения **HLR **(база данных с постоянными абонентами)&#x20;
* Центр аутентификации **AuC**

_Переменные:_

* **RAND **128-битное случайное число (отправляется МС от AuC для облегчения проверки подлинности МС)
* Запрос **SRES **отправляется МС (генерируется с помощью алгоритма RAND + Ki + A3)&#x20;
* Уникальный **KC** (генерируется с помощью алгоритма RAND + Ki + A8)

**Примечание**: данные шифруются с помощью алгоритма KC + A5 / 1

## Предварительная информация:

Прежде чем приступить к процессу шифрования, нужно учесть, что, не смотря на то, что существует три разных алгоритма (A3, A8 и A5 / 1), мы должны заметить следующее:

**Алгоритм A3** используется «только» для облегчения аутентификации мобильной станции (MС) в сети.&#x20;

* **После аутентификации алгоритм A8 **используется «только» для создания уникального ключа (KC), который в конечном итоге будет использоваться (МС и сетью) для шифрования / дешифрования данных с использованием потокового шифра A5/1.&#x20;
* **Алгоритм A3, алгоритм A8, IMSI и Ki** - записаны на SIM-карте МС (телефона), а алгоритм потокового шифрования A5 / 1 заложен в аппаратном обеспечении МС (телефона).&#x20;
* Кроме того, домашняя сеть **(HLR, VLR, MSC, AuC)** имеет доступ к той же информации через свои базы данных.&#x20;

**Диаграмма 1**

![](https://lh4.googleusercontent.com/5r2\_aCvjL8dFFSL\_tdoJvBPR\_HBV7ssS-lBkjcfWSaJhCdmF4MGnHXyLVNhTBy\_Wq8Q6dP6oTqvPdjpRUeJCjl4fjIc4A5Sqd8H71o9iBCVz9mjlnSnJdV4iOYA9lZHGCwAiQplm)

**Процесс: **(диаграмма 1)

1. Мобильная станция (МС) запрашивает доступ к сети, МС отправляет свой IMSI в подсистему (NSS) через BSC / BTS.
2. IMSI, отправленный МС, отправляется MSC сети, и MSC передает IMSI в HLR и запрашивает аутентификацию.
3. HLR проверяет свою базу данных, чтобы убедиться, что IMSI принадлежит данной сети.
   * Если IMSI принадлежит данной сети, HLR пересылает запрос аутентификации и IMSI в Центр аутентификации (AuC).
   * &#x20;AuC обращается к своей базе данных для поиска Ki, который связан с данным IMSI.
   * Auc генерирует 128-битное случайное число (RAND).&#x20;
   * RAND и Ki обрабатываются алгоритмом A3 (аутентификация), создавая 32-битный SRES (подписанный ответ). RAND передается (через BSC / BTS) на мобильную станцию ​​(МС).&#x20;
4. &#x20;RAND, полученный МС, вместе с ключом Ki SIM-карты передаются в алгоритм SIM-карты-A3 (аутентификация), генерируя ответ SRES.&#x20;
5. Ответ SRES передается (через BSC / BTS) обратно в AuC сети.&#x20;
6. AuC сравнивает отправленный SRES с полученным SRES. Если они совпадают, значит аутентификация прошла успешно. Абонент (МС) подключается к сети.&#x20;
7. RAND вместе с ключом Ki SIM-карты передаются в алгоритм SIM-карты-A8  для создания ключа шифрования (KC):
   * Сгенерированный KC используется с алгоритмом A5 для потокового шифрования или дешифрования данных.
   * Алгоритм A5 хранится в аппаратном обеспечении телефона и отвечает за шифрование и дешифрование данных в "режиме реального времени".

## **Уровни безопасности:**

_Алгоритмы_:

![](https://lh5.googleusercontent.com/2FWiU5\_5C8mqcQSFv8HKHSFHCHnIfvO7R0g9MA\_DsZ\_q4T4mJkSmWstcpkd\_4\_zSB24V-Zuc9lMbnn3OAst6tnuzDk-NJDhBmk7JbjDdjN46Qts6d3fRTz10fdupMZOeb5\_3HDLC)

**Обфускация IMSI: **

Когда абонент впервые подключается к сети, Центр аутентификации (AuC) назначает TMSI (временный IMSI), который будет использоваться вместо IMSI абонента в дальнейшем. Я называю TMSI «временным», но на самом деле TMSI хранится (вместе с IMSI) в VLR (регистре местоположения абонентов).&#x20;

Когда телефон выключен, телефон сохраняет TMSI на своей SIM-карте, обеспечивая его доступность при повторном включении.&#x20;

Каждое новое обновление (роуминг, передача обслуживания и т.д.) приводит к созданию нового TMSI. TMSI используется вместо IMSI для защиты конфиденциальности абонента.

**Скриншоты с примерами пакетов:**

_Запрос на обновление местоположения (TMSI еще не установлен)_

![](https://lh5.googleusercontent.com/iyrdJ4LHWFUngtQXPYr\_CQaA71NMgqbUjKxdzDXq5mEBmiPcEFq24snmvqbt4m\_kMqeYMwSXyvdjGRF8TXatAhyOCC2O8F8DFVJec0IlldfvsmGXnUhXFPp2B1k2nU7zaAh1Oujy)

_Запрос на аутентификацию_

![](https://lh4.googleusercontent.com/c0W3atWxW7TU0i\_MXO5twIBp9WSvX8opriwNtCmb2i01\_R80pFFYb2duiW2iZ2F1wIc4KZW9K\_-lluV9feBGNyUuqQKdzVjYuTYmp05f6UE0Fj1sulGSe3Q3pyvfTZOJajkfEIrT)

_Поддерживаемый алгоритм TMSI / A5 / 1_

![](https://lh5.googleusercontent.com/amAB08uW\_TOcCm0cQIRnhmSyw4Mp6uhH74tO5kD90v73h4s7tvRQLV7cwqWKy84tKwaaPDj8koeQayl5nPk0RMXwt93SolKVNVgb6adKC0KmbD73DXvj9wb3UoEAwFmwNWhxRA8D)

## **Заключение**

В этой статье описаны некоторые из моих исследований по анализу трафика GSM, который я записал с помощью SDR. Смысл этой работы в том, чтобы лучше понять протоколы и процедуры мобильной сети GSM с погрешностью на применяемые алгоритмы аутентификации и шифрования.&#x20;

На мой взгляд, существует огромная потребность в изучении подобных материалов относительно затронутого вектора атаки, по мере того, как мы движемся к внедрению технологий 5G. Алгоритм потокового шифрования A5 / 1 до сих пор используется во многих сетях GSM, и помимо этого, существует довольно много сетей, которые вообще не реализуют шифрование в своих протоколах (данные SMS полностью открыты).&#x20;

Эти уязвимости подвергают угрозе наши SMS-сообщения, личные данные и даже местоположения GPS. Требуются дополнительные исследования в этой области, чтобы гарантировать безопасность нашей конфиденциальности. С точки зрения InfoSec поверхность атак на сотовые сети довольно широка это и атаки MiTM, и нарушения работы сети и т. д.

## **Ссылки**

[https://www.sans.org/reading-room/whitepapers/telephone/gsm-standard-an-overview-security-317](https://www.sans.org/reading-room/whitepapers/telephone/gsm-standard-an-overview-security-317)

[https://en.wikipedia.org/wiki/GSM](https://en.wikipedia.org/wiki/GSM)

[https://payatu.com/blog\_28](https://payatu.com/blog\_28)&#x20;

[https://payatu.com/blogger\_by%20Rashid%20Feroze](https://payatu.com/blogger\_by%20Rashid%20Feroze)
